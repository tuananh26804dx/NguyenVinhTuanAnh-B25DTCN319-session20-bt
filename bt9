#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// 1. Khai báo cấu trúc Dish
typedef struct {
    int id;
    char name[50];
    double price;
} Dish;

// Khai báo mảng cấu trúc và số lượng phần tử hiện tại
#define MAX_DISHES 100
Dish menu[MAX_DISHES];
int dishCount = 0; // Biến theo dõi số lượng món ăn thực tế

// --- CÁC HÀM XỬ LÝ CHỨC NĂNG ---

// Khởi tạo 5 phần tử sẵn có
void initializeMenu() {
    if (dishCount == 0) {
        menu[0] = (Dish){101, "Pho Bo", 50.0};
        menu[1] = (Dish){102, "Bun Cha", 45.0};
        menu[2] = (Dish){103, "Banh Mi", 25.0};
        menu[3] = (Dish){104, "Com Tam", 55.0};
        menu[4] = (Dish){105, "Goi Cuon", 30.0};
        dishCount = 5;
    }
}

// Chức năng 1: In ra giá trị các phần tử có trong menu
void printMenu() {
    printf("\n--- Danh sách Menu Hiện tại (%d món) ---\n", dishCount);
    if (dishCount == 0) {
        printf("Menu trống.\n");
        return;
    }

    printf("STT | ID  | Tên Món Ăn\t\t\t| Giá (VND)\n");
    printf("----|-----|-----------------------------------|----------\n");
    for (int i = 0; i < dishCount; i++) {
        printf("%3d | %-3d | %-30s| %.2lf\n", 
               i + 1, 
               menu[i].id, 
               menu[i].name, 
               menu[i].price);
    }
    printf("----------------------------------------------------------\n");
}

// Hàm hỗ trợ nhập món ăn mới
void inputDish(Dish *dish) {
    printf("Nhập ID món ăn: ");
    if (scanf("%d", &dish->id) != 1) return;
    
    while (getchar() != '\n'); // Xóa bộ đệm
    
    printf("Nhập Tên món ăn: ");
    fgets(dish->name, sizeof(dish->name), stdin);
    dish->name[strcspn(dish->name, "\n")] = 0; 
    
    printf("Nhập Giá (VND): ");
    if (scanf("%lf", &dish->price) != 1) return;
    while (getchar() != '\n'); // Xóa bộ đệm
}

// Chức năng 2: Thêm một phần từ vào vị trí chỉ định
void addDish() {
    if (dishCount >= MAX_DISHES) {
        printf("\n Lỗi: Menu đã đầy! Không thể thêm mới.\n");
        return;
    }

    int position;
    printf("\n--- Thêm Món Ăn Mới ---\n");
    printf("Nhập vị trí (từ 1 đến %d) cần thêm: ", dishCount + 1);
    if (scanf("%d", &position) != 1) return;
    
    if (position < 1 || position > dishCount + 1) {
        printf(" Lỗi: Vị trí thêm không hợp lệ. Vui lòng chọn từ 1 đến %d.\n", dishCount + 1);
        while (getchar() != '\n');
        return;
    }
    
    Dish newDish;
    inputDish(&newDish);
    
    int index = position - 1; // Chuyển sang index mảng (0-based)

    // Dịch chuyển các phần tử từ vị trí index trở đi sang phải 1 ô
    for (int i = dishCount; i > index; i--) {
        menu[i] = menu[i - 1];
    }

    // Chèn món ăn mới
    menu[index] = newDish;
    dishCount++;

    printf("\n Đã thêm thành công món '%s' vào vị trí %d.\n", newDish.name, position);
}

// Chức năng 3: Sửa một phần từ ở vị trí chỉ định
void editDish() {
    if (dishCount == 0) {
        printf("\n️ Lỗi: Menu trống, không có gì để sửa.\n");
        return;
    }

    int position;
    printf("\n--- Sửa Món Ăn ---\n");
    printf("Nhập vị trí (từ 1 đến %d) cần sửa: ", dishCount);
    if (scanf("%d", &position) != 1) return;
    
    if (position < 1 || position > dishCount) {
        printf("⚠️ Lỗi: Vị trí sửa không hợp lệ.\n");
        while (getchar() != '\n');
        return;
    }
    
    int index = position - 1;
    printf("\nThông tin món ăn cũ: ID %d, Tên %s, Giá %.2lf\n", 
           menu[index].id, menu[index].name, menu[index].price);
           
    Dish updatedDish;
    printf("--- Nhập thông tin mới ---\n");
    inputDish(&updatedDish);

    // Cập nhật món ăn
    menu[index] = updatedDish;
    
    printf("\n Đã sửa thành công món ăn tại vị trí %d thành '%s'.\n", position, updatedDish.name);
}

// Chức năng 4: Xóa một phần từ ở vị trí chỉ định
void deleteDish() {
    if (dishCount == 0) {
        printf("\n️ Lỗi: Menu trống, không có gì để xóa.\n");
        return;
    }
    
    int position;
    printf("\n--- Xóa Món Ăn ---\n");
    printf("Nhập vị trí (từ 1 đến %d) cần xóa: ", dishCount);
    if (scanf("%d", &position) != 1) return;
    
    if (position < 1 || position > dishCount) {
        printf("Lỗi: Vị trí xóa không hợp lệ.\n");
        while (getchar() != '\n');
        return;
    }
    
    int index = position - 1;
    char deletedName[50];
    strcpy(deletedName, menu[index].name); // Lưu tên món ăn bị xóa

    // Dịch chuyển các phần tử từ vị trí index + 1 trở đi sang trái 1 ô
    for (int i = index; i < dishCount - 1; i++) {
        menu[i] = menu[i + 1];
    }

    dishCount--; // Giảm số lượng món ăn

    printf("\n Đã xóa thành công món '%s' tại vị trí %d.\n", deletedName, position);
}

// Hàm so sánh cho qsort (Giảm dần theo price: a < b)
int comparePriceDesc(const void *a, const void *b) {
    Dish *dishA = (Dish *)a;
    Dish *dishB = (Dish *)b;
    if (dishA->price < dishB->price) return 1;
    if (dishA->price > dishB->price) return -1;
    return 0;
}

// Hàm so sánh cho qsort (Tăng dần theo price: a > b)
int comparePriceAsc(const void *a, const void *b) {
    Dish *dishA = (Dish *)a;
    Dish *dishB = (Dish *)b;
    if (dishA->price > dishB->price) return 1;
    if (dishA->price < dishB->price) return -1;
    return 0;
}

// Chức năng 5: Sắp xếp
void sortMenu() {
    int choice;
    printf("\n--- Sắp xếp Menu ---\n");
    printf("  a. Giảm dần theo price\n");
